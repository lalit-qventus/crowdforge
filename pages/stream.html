<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forge Stream — CrowdForge</title>
  <meta name="description" content="Watch a startup being built in real-time. Live code, live commits, live collaboration.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,700;12..96,800&family=Instrument+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../styles/design-system.css">
  <style>
    /* ── STREAM PAGE ── */
    html, body {
      height: 100%;
      overflow: hidden;
    }

    .stream-page {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: grid;
      grid-template-rows: auto 1fr auto;
      grid-template-columns: 240px 1fr 280px;
      grid-template-areas:
        "header header header"
        "sidebar-left center sidebar-right"
        "bottom bottom bottom";
      background: var(--bg-deep);
      overflow: hidden;
    }

    /* ── ATMOSPHERE ── */
    .stream-atmosphere {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
    }

    .stream-particles {
      position: absolute;
      inset: 0;
    }

    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: var(--accent-cyan);
      border-radius: 50%;
      opacity: 0;
      animation: particle-float linear infinite;
    }

    .particle:nth-child(1) { left: 10%; animation-duration: 25s; animation-delay: 0s; }
    .particle:nth-child(2) { left: 20%; animation-duration: 30s; animation-delay: 3s; }
    .particle:nth-child(3) { left: 35%; animation-duration: 22s; animation-delay: 7s; }
    .particle:nth-child(4) { left: 50%; animation-duration: 28s; animation-delay: 2s; }
    .particle:nth-child(5) { left: 65%; animation-duration: 32s; animation-delay: 5s; }
    .particle:nth-child(6) { left: 75%; animation-duration: 26s; animation-delay: 8s; }
    .particle:nth-child(7) { left: 85%; animation-duration: 20s; animation-delay: 1s; }
    .particle:nth-child(8) { left: 40%; animation-duration: 35s; animation-delay: 10s; }
    .particle:nth-child(9) { left: 55%; animation-duration: 24s; animation-delay: 4s; }
    .particle:nth-child(10) { left: 90%; animation-duration: 29s; animation-delay: 6s; }
    .particle:nth-child(11) { left: 5%; animation-duration: 27s; animation-delay: 9s; }
    .particle:nth-child(12) { left: 30%; animation-duration: 31s; animation-delay: 11s; }

    .particle:nth-child(even) {
      background: var(--accent-green);
      width: 1.5px;
      height: 1.5px;
    }

    .particle:nth-child(3n) {
      background: var(--accent-violet);
      width: 1px;
      height: 1px;
    }

    @keyframes particle-float {
      0% {
        transform: translateY(100vh) translateX(0);
        opacity: 0;
      }
      5% { opacity: 0.4; }
      50% {
        transform: translateY(50vh) translateX(30px);
        opacity: 0.2;
      }
      95% { opacity: 0.3; }
      100% {
        transform: translateY(-20px) translateX(-20px);
        opacity: 0;
      }
    }

    .stream-gradient-shift {
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at 30% 50%, rgba(0, 255, 213, 0.03) 0%, transparent 60%),
                  radial-gradient(ellipse at 70% 30%, rgba(167, 139, 250, 0.02) 0%, transparent 50%),
                  radial-gradient(ellipse at 50% 80%, rgba(245, 166, 35, 0.02) 0%, transparent 50%);
      animation: gradient-shift 30s ease-in-out infinite;
    }

    @keyframes gradient-shift {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .stream-scanlines {
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0, 0, 0, 0.02) 2px,
        rgba(0, 0, 0, 0.02) 4px
      );
    }

    /* ── OVERLAY HEADER ── */
    .stream-header {
      grid-area: header;
      position: relative;
      z-index: 50;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 20px;
      background: rgba(10, 10, 12, 0.8);
      backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid var(--border-subtle);
    }

    .stream-header-left {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .stream-back {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: var(--radius-sm);
      background: transparent;
      border: 1px solid var(--border-subtle);
      color: var(--text-secondary);
      transition: all 0.2s var(--ease-out);
    }

    .stream-back:hover {
      border-color: var(--text-secondary);
      color: var(--text-primary);
    }

    .stream-back svg {
      width: 16px;
      height: 16px;
    }

    .stream-label {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .stream-label-text {
      font-family: var(--font-mono);
      font-size: 0.72rem;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--text-primary);
    }

    .stream-header-center {
      display: flex;
      align-items: center;
      gap: 16px;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }

    .stream-project-name {
      font-family: var(--font-display);
      font-weight: 700;
      font-size: 1rem;
      color: var(--text-primary);
      letter-spacing: -0.01em;
    }

    .stream-spectators {
      font-family: var(--font-mono);
      font-size: 0.68rem;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .stream-spectators svg {
      width: 14px;
      height: 14px;
      color: var(--text-muted);
    }

    .stream-header-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .stream-icon-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: var(--radius-sm);
      background: transparent;
      border: 1px solid var(--border-subtle);
      color: var(--text-secondary);
      transition: all 0.2s var(--ease-out);
    }

    .stream-icon-btn:hover {
      border-color: var(--text-secondary);
      color: var(--text-primary);
    }

    .stream-icon-btn svg {
      width: 16px;
      height: 16px;
    }

    .stream-join-btn {
      padding: 8px 18px;
      font-size: 0.72rem;
    }

    /* ── LEFT SIDEBAR — ACTIVITY LOG ── */
    .stream-activity {
      grid-area: sidebar-left;
      position: relative;
      z-index: 10;
      display: flex;
      flex-direction: column;
      background: rgba(10, 10, 12, 0.6);
      backdrop-filter: blur(12px);
      border-right: 1px solid var(--border-subtle);
      overflow: hidden;
    }

    .stream-activity-header {
      padding: 14px 16px;
      border-bottom: 1px solid var(--border-subtle);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .stream-activity-title {
      font-family: var(--font-mono);
      font-size: 0.65rem;
      font-weight: 600;
      color: var(--accent-cyan);
      letter-spacing: 0.15em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stream-activity-count {
      font-family: var(--font-mono);
      font-size: 0.6rem;
      color: var(--text-muted);
    }

    .stream-activity-feed {
      flex: 1;
      overflow: hidden;
      padding: 8px 0;
      position: relative;
    }

    .stream-activity-feed::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: linear-gradient(to top, rgba(10, 10, 12, 0.9), transparent);
      pointer-events: none;
      z-index: 2;
    }

    .activity-event {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 8px 16px;
      animation: event-slide-in 0.5s var(--ease-out);
      transition: opacity 0.5s var(--ease-out);
    }

    .activity-event.fading {
      opacity: 0.15;
    }

    @keyframes event-slide-in {
      from {
        opacity: 0;
        transform: translateY(-12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .activity-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      flex-shrink: 0;
      margin-top: 5px;
    }

    .activity-dot--cyan { background: var(--accent-cyan); box-shadow: 0 0 6px rgba(0, 255, 213, 0.4); }
    .activity-dot--violet { background: var(--accent-violet); box-shadow: 0 0 6px rgba(167, 139, 250, 0.4); }
    .activity-dot--green { background: var(--accent-green); box-shadow: 0 0 6px rgba(57, 255, 20, 0.4); }
    .activity-dot--amber { background: var(--accent-amber); box-shadow: 0 0 6px rgba(245, 166, 35, 0.4); }
    .activity-dot--gold { background: var(--accent-gold); box-shadow: 0 0 6px rgba(255, 215, 0, 0.4); }
    .activity-dot--coral { background: var(--accent-coral); box-shadow: 0 0 6px rgba(255, 107, 107, 0.4); }

    .activity-content {
      flex: 1;
      min-width: 0;
    }

    .activity-text {
      font-family: var(--font-mono);
      font-size: 0.68rem;
      color: var(--text-secondary);
      line-height: 1.5;
      word-break: break-word;
    }

    .activity-text strong {
      color: var(--text-primary);
      font-weight: 600;
    }

    .activity-text .bot-name {
      color: var(--accent-violet);
      font-weight: 600;
      padding: 0 2px;
      border: 1px dashed rgba(167, 139, 250, 0.3);
      border-radius: 3px;
    }

    .activity-time {
      font-family: var(--font-mono);
      font-size: 0.58rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    /* ── CENTER STAGE — CODE VIEW ── */
    .stream-center {
      grid-area: center;
      position: relative;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      overflow: hidden;
    }

    .code-stage {
      width: 100%;
      max-width: 820px;
      height: 100%;
      display: flex;
      flex-direction: column;
      background: var(--bg-surface);
      border: 1px solid var(--border-active);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: 0 24px 80px rgba(0, 0, 0, 0.6), var(--glow-cyan);
      transition: border-color 0.4s var(--ease-out), box-shadow 0.4s var(--ease-out);
    }

    .code-stage.commit-flash {
      border-color: var(--accent-green);
      box-shadow: 0 24px 80px rgba(0, 0, 0, 0.6), var(--glow-green);
    }

    .code-chrome {
      display: flex;
      align-items: center;
      padding: 10px 16px;
      background: var(--bg-elevated);
      border-bottom: 1px solid var(--border-subtle);
      gap: 8px;
      flex-shrink: 0;
    }

    .code-chrome-dots {
      display: flex;
      gap: 6px;
    }

    .code-chrome-tab {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-left: 16px;
      padding: 4px 12px;
      background: var(--bg-surface);
      border-radius: var(--radius-sm) var(--radius-sm) 0 0;
      border: 1px solid var(--border-subtle);
      border-bottom: none;
      font-family: var(--font-mono);
      font-size: 0.65rem;
      color: var(--text-secondary);
    }

    .code-chrome-tab-icon {
      width: 12px;
      height: 12px;
      color: var(--accent-amber);
    }

    .code-chrome-branch {
      margin-left: auto;
      font-family: var(--font-mono);
      font-size: 0.6rem;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .code-chrome-branch svg {
      width: 12px;
      height: 12px;
    }

    .code-body {
      flex: 1;
      overflow: hidden;
      position: relative;
      padding: 0;
    }

    .code-scroll {
      height: 100%;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--bg-overlay) transparent;
    }

    .code-scroll::-webkit-scrollbar {
      width: 6px;
    }

    .code-scroll::-webkit-scrollbar-track {
      background: transparent;
    }

    .code-scroll::-webkit-scrollbar-thumb {
      background: var(--bg-overlay);
      border-radius: 3px;
    }

    .code-lines {
      display: grid;
      grid-template-columns: 48px 1fr;
      font-family: var(--font-mono);
      font-size: 0.76rem;
      line-height: 2;
    }

    .code-line-number {
      text-align: right;
      padding-right: 16px;
      color: var(--text-muted);
      user-select: none;
      opacity: 0.5;
    }

    .code-line-content {
      padding-right: 20px;
      white-space: pre;
      min-height: 1.6em;
    }

    .code-line-active {
      background: rgba(0, 255, 213, 0.03);
    }

    .code-cursor {
      display: inline-block;
      width: 2px;
      height: 1.1em;
      background: var(--accent-cyan);
      animation: cursor-anim 1s step-end infinite;
      vertical-align: text-bottom;
      box-shadow: 0 0 4px rgba(0, 255, 213, 0.5);
    }

    /* Commit overlay */
    .commit-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      background: rgba(10, 10, 12, 0.92);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(57, 255, 20, 0.3);
      border-radius: var(--radius-lg);
      padding: 20px 32px;
      display: flex;
      align-items: center;
      gap: 14px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s var(--ease-out), transform 0.3s var(--ease-out);
      z-index: 20;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5), var(--glow-green);
    }

    .commit-overlay.visible {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    .commit-overlay-icon {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(57, 255, 20, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .commit-overlay-icon svg {
      width: 16px;
      height: 16px;
      color: var(--accent-green);
    }

    .commit-overlay-text {
      font-family: var(--font-mono);
      font-size: 0.76rem;
      color: var(--accent-green);
      font-weight: 600;
    }

    .commit-overlay-msg {
      font-family: var(--font-mono);
      font-size: 0.68rem;
      color: var(--text-secondary);
      margin-top: 2px;
    }

    /* ── RIGHT SIDEBAR — CHAT ── */
    .stream-chat {
      grid-area: sidebar-right;
      position: relative;
      z-index: 10;
      display: flex;
      flex-direction: column;
      background: rgba(10, 10, 12, 0.6);
      backdrop-filter: blur(12px);
      border-left: 1px solid var(--border-subtle);
      overflow: hidden;
    }

    .stream-chat-header {
      padding: 14px 16px;
      border-bottom: 1px solid var(--border-subtle);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .stream-chat-title {
      font-family: var(--font-mono);
      font-size: 0.65rem;
      font-weight: 600;
      color: var(--accent-cyan);
      letter-spacing: 0.15em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stream-chat-online {
      font-family: var(--font-mono);
      font-size: 0.6rem;
      color: var(--accent-green);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .stream-chat-online::before {
      content: '';
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: var(--accent-green);
      box-shadow: 0 0 6px rgba(57, 255, 20, 0.5);
    }

    .stream-chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      scrollbar-width: thin;
      scrollbar-color: var(--bg-overlay) transparent;
    }

    .stream-chat-messages::-webkit-scrollbar {
      width: 4px;
    }

    .stream-chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }

    .stream-chat-messages::-webkit-scrollbar-thumb {
      background: var(--bg-overlay);
      border-radius: 2px;
    }

    .chat-msg {
      display: flex;
      gap: 10px;
      animation: chat-msg-in 0.4s var(--ease-out);
    }

    @keyframes chat-msg-in {
      from {
        opacity: 0;
        transform: translateY(8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .chat-avatar {
      width: 28px;
      height: 28px;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-mono);
      font-size: 0.6rem;
      font-weight: 600;
      flex-shrink: 0;
    }

    .chat-avatar--cyan { background: rgba(0, 255, 213, 0.12); color: var(--accent-cyan); }
    .chat-avatar--green { background: rgba(57, 255, 20, 0.12); color: var(--accent-green); }
    .chat-avatar--amber { background: rgba(245, 166, 35, 0.12); color: var(--accent-amber); }
    .chat-avatar--coral { background: rgba(255, 107, 107, 0.12); color: var(--accent-coral); }
    .chat-avatar--violet {
      background: rgba(167, 139, 250, 0.12);
      color: var(--accent-violet);
      border: 1px dashed rgba(167, 139, 250, 0.3);
    }

    .chat-body {
      flex: 1;
      min-width: 0;
    }

    .chat-meta {
      display: flex;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 2px;
    }

    .chat-name {
      font-family: var(--font-mono);
      font-size: 0.68rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .chat-name--bot {
      color: var(--accent-violet);
    }

    .chat-time {
      font-family: var(--font-mono);
      font-size: 0.56rem;
      color: var(--text-muted);
    }

    .chat-text {
      font-family: var(--font-body);
      font-size: 0.78rem;
      color: var(--text-secondary);
      line-height: 1.5;
      word-break: break-word;
    }

    .stream-chat-input {
      padding: 12px;
      border-top: 1px solid var(--border-subtle);
      flex-shrink: 0;
      position: relative;
    }

    .stream-chat-input-field {
      width: 100%;
      padding: 10px 14px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      font-family: var(--font-mono);
      font-size: 0.72rem;
      color: var(--text-muted);
      cursor: not-allowed;
      transition: border-color 0.2s;
    }

    .stream-chat-input-field:focus {
      outline: none;
    }

    .stream-chat-input-tooltip {
      position: absolute;
      bottom: calc(100% + 4px);
      left: 12px;
      right: 12px;
      padding: 6px 10px;
      background: var(--bg-overlay);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      font-family: var(--font-mono);
      font-size: 0.62rem;
      color: var(--text-muted);
      text-align: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .stream-chat-input:hover .stream-chat-input-tooltip,
    .stream-chat-input:focus-within .stream-chat-input-tooltip {
      opacity: 1;
    }

    /* ── BOTTOM BAR — PROJECT HEALTH ── */
    .stream-bottom {
      grid-area: bottom;
      position: relative;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 24px;
      background: rgba(10, 10, 12, 0.85);
      backdrop-filter: blur(20px);
      border-top: 1px solid var(--border-subtle);
      gap: 24px;
      overflow: hidden;
    }

    .stream-bottom::before {
      content: '';
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 0.3;
    }

    .bottom-heartbeat {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg,
        transparent 0%,
        var(--accent-cyan) 20%,
        var(--accent-green) 40%,
        var(--accent-cyan) 60%,
        var(--accent-violet) 80%,
        transparent 100%
      );
      opacity: 0.4;
      animation: heartbeat-wave 3s ease-in-out infinite;
    }

    @keyframes heartbeat-wave {
      0% { transform: translateX(-100%); opacity: 0.2; }
      50% { opacity: 0.5; }
      100% { transform: translateX(100%); opacity: 0.2; }
    }

    .bottom-metric {
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: var(--font-mono);
      font-size: 0.68rem;
    }

    .bottom-metric-label {
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 0.6rem;
    }

    .bottom-metric-value {
      color: var(--text-secondary);
    }

    .bottom-metric-value strong {
      color: var(--text-primary);
      font-weight: 600;
    }

    .bottom-progress-wrap {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .bottom-mini-progress {
      width: 60px;
      height: 3px;
      background: var(--bg-overlay);
      border-radius: var(--radius-full);
      overflow: hidden;
    }

    .bottom-mini-progress-fill {
      height: 100%;
      border-radius: var(--radius-full);
      background: linear-gradient(90deg, var(--accent-cyan), var(--accent-green));
      transition: width 0.6s var(--ease-out);
    }

    .bottom-avatars {
      display: flex;
      margin-left: 4px;
    }

    .bottom-avatars .mini-avatar {
      width: 20px;
      height: 20px;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-mono);
      font-size: 0.5rem;
      font-weight: 600;
      margin-left: -4px;
      border: 1.5px solid var(--bg-deep);
    }

    .bottom-avatars .mini-avatar:first-child { margin-left: 0; }

    .bottom-commit-pulse {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent-green);
      box-shadow: 0 0 8px rgba(57, 255, 20, 0.5);
      animation: blink 2s ease-in-out infinite;
      flex-shrink: 0;
    }

    .bottom-revenue {
      color: var(--accent-gold);
      font-weight: 600;
    }

    .bottom-separator {
      width: 1px;
      height: 20px;
      background: var(--border-subtle);
      flex-shrink: 0;
    }

    /* ── KEYBOARD SHORTCUTS HINT ── */
    .stream-shortcuts {
      position: fixed;
      bottom: 56px;
      right: 20px;
      z-index: 60;
      display: flex;
      gap: 8px;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
    }

    .stream-page:hover .stream-shortcuts {
      opacity: 1;
    }

    .shortcut-key {
      padding: 3px 7px;
      background: var(--bg-overlay);
      border: 1px solid var(--border-subtle);
      border-radius: 4px;
      font-family: var(--font-mono);
      font-size: 0.58rem;
      color: var(--text-muted);
    }

    /* ── RESPONSIVE ── */
    @media (max-width: 1024px) {
      .stream-page {
        grid-template-columns: 200px 1fr 240px;
      }
    }

    @media (max-width: 768px) {
      .stream-page {
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr auto;
        grid-template-areas:
          "header"
          "center"
          "bottom";
      }

      .stream-activity,
      .stream-chat {
        display: none;
      }

      .stream-header-center {
        position: static;
        transform: none;
      }

      .stream-center {
        padding: 12px;
      }
    }

    /* ── REDUCED MOTION ── */
    @media (prefers-reduced-motion: reduce) {
      .particle,
      .stream-gradient-shift,
      .bottom-heartbeat {
        animation: none;
        opacity: 0;
      }

      .commit-overlay {
        transition: none;
      }
    }
  </style>
</head>
<body>
  <!-- Atmosphere -->
  <div class="stream-atmosphere" aria-hidden="true">
    <div class="stream-gradient-shift"></div>
    <div class="stream-particles">
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
    </div>
    <div class="stream-scanlines"></div>
  </div>

  <!-- Stream Page -->
  <main class="stream-page" role="main" aria-label="Forge Stream: Live startup build">

    <!-- Header -->
    <header class="stream-header" role="banner">
      <div class="stream-header-left">
        <a href="/" class="stream-back" aria-label="Back to projects">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M19 12H5"/><path d="m12 19-7-7 7-7"/></svg>
        </a>
        <div class="stream-label">
          <span class="stream-label-text">Forge Stream</span>
          <span class="badge badge--live" aria-label="Live now">Live</span>
        </div>
      </div>

      <div class="stream-header-center">
        <span class="stream-project-name">PetMatch AI</span>
        <span class="stream-spectators" aria-live="polite">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
          <span id="spectator-count">1,247</span> watching
        </span>
      </div>

      <div class="stream-header-right">
        <button class="stream-icon-btn" aria-label="Toggle volume" id="volume-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>
        </button>
        <button class="stream-icon-btn" aria-label="Toggle fullscreen (F)" id="fullscreen-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M8 3H5a2 2 0 0 0-2 2v3"/><path d="M21 8V5a2 2 0 0 0-2-2h-3"/><path d="M3 16v3a2 2 0 0 0 2 2h3"/><path d="M16 21h3a2 2 0 0 0 2-2v-3"/></svg>
        </button>
        <button class="btn btn--primary stream-join-btn">Join the Build</button>
      </div>
    </header>

    <!-- Left Sidebar: Activity Log -->
    <aside class="stream-activity" aria-label="Activity log">
      <div class="stream-activity-header">
        <div class="stream-activity-title">
          <span class="pulse-dot" aria-hidden="true"></span>
          Activity
        </div>
        <span class="stream-activity-count" aria-live="polite" id="activity-count">46 today</span>
      </div>
      <div class="stream-activity-feed" id="activity-feed" role="log" aria-label="Project activity feed" aria-live="polite">
        <!-- Events injected by JS -->
      </div>
    </aside>

    <!-- Center Stage: Live Code -->
    <section class="stream-center" aria-label="Live code editor">
      <div class="code-stage" id="code-stage">
        <div class="code-chrome">
          <div class="code-chrome-dots" aria-hidden="true">
            <span class="terminal-dot terminal-dot--red"></span>
            <span class="terminal-dot terminal-dot--yellow"></span>
            <span class="terminal-dot terminal-dot--green"></span>
          </div>
          <div class="code-chrome-tab">
            <svg class="code-chrome-tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="m18 16 4-4-4-4"/><path d="m6 8-4 4 4 4"/><path d="m14.5 4-5 16"/></svg>
            matcher.ts
          </div>
          <div class="code-chrome-branch" aria-label="Git branch: feat/matching-algo">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><line x1="6" y1="3" x2="6" y2="15"/><circle cx="18" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><path d="M18 9a9 9 0 0 1-9 9"/></svg>
            feat/matching-algo
          </div>
        </div>
        <div class="code-body">
          <div class="code-scroll" id="code-scroll">
            <div class="code-lines" id="code-lines" role="presentation" aria-label="Code being written in real-time">
              <!-- Code lines injected by JS -->
            </div>
          </div>
        </div>

        <!-- Commit Overlay -->
        <div class="commit-overlay" id="commit-overlay" role="alert" aria-atomic="true">
          <div class="commit-overlay-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
          </div>
          <div>
            <div class="commit-overlay-text">Committed</div>
            <div class="commit-overlay-msg" id="commit-msg"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Right Sidebar: Chat -->
    <aside class="stream-chat" aria-label="Contributor chat">
      <div class="stream-chat-header">
        <div class="stream-chat-title">
          Chat
        </div>
        <span class="stream-chat-online">12 online</span>
      </div>
      <div class="stream-chat-messages" id="chat-messages" role="log" aria-label="Chat messages" aria-live="polite">
        <!-- Chat messages injected by JS -->
      </div>
      <div class="stream-chat-input">
        <div class="stream-chat-input-tooltip" role="tooltip" id="chat-tooltip">Join the project to chat</div>
        <input
          type="text"
          class="stream-chat-input-field"
          placeholder="Send a message..."
          disabled
          aria-label="Chat message input (join to chat)"
          aria-describedby="chat-tooltip"
        >
      </div>
    </aside>

    <!-- Bottom Bar: Project Health -->
    <footer class="stream-bottom" aria-label="Project health metrics">
      <div class="bottom-metric">
        <span class="bottom-metric-label">Tasks</span>
        <div class="bottom-progress-wrap">
          <span class="bottom-metric-value" id="tasks-metric"><strong>8</strong> open / <strong>4</strong> in progress / <strong>34</strong> done</span>
          <div class="bottom-mini-progress" role="progressbar" aria-valuenow="74" aria-valuemin="0" aria-valuemax="100" aria-label="Task completion">
            <div class="bottom-mini-progress-fill" id="tasks-progress" style="width: 74%;"></div>
          </div>
        </div>
      </div>

      <div class="bottom-separator" aria-hidden="true"></div>

      <div class="bottom-metric">
        <span class="bottom-metric-label">Contributors</span>
        <span class="bottom-metric-value"><strong id="contributors-count">12</strong> active now</span>
        <div class="bottom-avatars" aria-hidden="true">
          <div class="mini-avatar chat-avatar--cyan">C</div>
          <div class="mini-avatar chat-avatar--green">D</div>
          <div class="mini-avatar chat-avatar--amber">E</div>
          <div class="mini-avatar chat-avatar--coral">A</div>
          <div class="mini-avatar chat-avatar--violet">B7</div>
        </div>
      </div>

      <div class="bottom-separator" aria-hidden="true"></div>

      <div class="bottom-metric">
        <span class="bottom-metric-label">Uptime</span>
        <span class="bottom-metric-value">Last commit: <strong id="last-commit-time">12s</strong> ago</span>
        <div class="bottom-commit-pulse" aria-hidden="true"></div>
      </div>

      <div class="bottom-separator" aria-hidden="true"></div>

      <div class="bottom-metric">
        <span class="bottom-metric-label">Revenue</span>
        <span class="bottom-metric-value bottom-revenue" id="revenue-metric">$2,840/mo</span>
      </div>

      <div class="bottom-heartbeat" aria-hidden="true"></div>
    </footer>

    <!-- Keyboard shortcuts hint -->
    <div class="stream-shortcuts" aria-hidden="true">
      <span class="shortcut-key">F</span>
      <span class="shortcut-key">Esc</span>
    </div>

  </main>

  <script>
    (function () {
      'use strict';

      // ── CODE TYPING ANIMATION ──
      const codeBlocks = [
        {
          filename: 'matcher.ts',
          branch: 'feat/matching-algo',
          lines: [
            { text: '// Pet matching algorithm — weighted compatibility scoring', cls: 'syn-comment' },
            { text: '' },
            { text: '<span class="syn-keyword">import</span> { Pet, UserPreferences, MatchResult } <span class="syn-keyword">from</span> <span class="syn-string">\'./types\'</span>;', cls: '' },
            { text: '<span class="syn-keyword">import</span> { <span class="syn-function">normalizeVector</span>, <span class="syn-function">cosineSimilarity</span> } <span class="syn-keyword">from</span> <span class="syn-string">\'./math\'</span>;', cls: '' },
            { text: '' },
            { text: '<span class="syn-keyword">const</span> <span class="syn-function">WEIGHTS</span> = {', cls: '' },
            { text: '  temperament: <span class="syn-number">0.35</span>,', cls: '' },
            { text: '  activityLevel: <span class="syn-number">0.25</span>,', cls: '' },
            { text: '  sizePreference: <span class="syn-number">0.20</span>,', cls: '' },
            { text: '  allergySafe: <span class="syn-number">0.15</span>,', cls: '' },
            { text: '  proximity: <span class="syn-number">0.05</span>,', cls: '' },
            { text: '} <span class="syn-keyword">as const</span>;', cls: '' },
            { text: '' },
            { text: '<span class="syn-keyword">export async function</span> <span class="syn-function">findMatches</span>(', cls: '' },
            { text: '  prefs: <span class="syn-type">UserPreferences</span>,', cls: '' },
            { text: '  candidates: <span class="syn-type">Pet</span>[],', cls: '' },
            { text: '  limit = <span class="syn-number">10</span>', cls: '' },
            { text: '): <span class="syn-type">Promise</span>&lt;<span class="syn-type">MatchResult</span>[]&gt; {', cls: '' },
            { text: '' },
            { text: '  <span class="syn-keyword">const</span> userVector = <span class="syn-function">buildPreferenceVector</span>(prefs);', cls: '' },
            { text: '' },
            { text: '  <span class="syn-keyword">const</span> scored = candidates.<span class="syn-function">map</span>((pet) <span class="syn-keyword">=></span> {', cls: '' },
            { text: '    <span class="syn-keyword">const</span> petVector = <span class="syn-function">buildPetVector</span>(pet);', cls: '' },
            { text: '    <span class="syn-keyword">const</span> raw = <span class="syn-function">cosineSimilarity</span>(', cls: '' },
            { text: '      <span class="syn-function">normalizeVector</span>(userVector),', cls: '' },
            { text: '      <span class="syn-function">normalizeVector</span>(petVector)', cls: '' },
            { text: '    );', cls: '' },
            { text: '' },
            { text: '    <span class="syn-comment">// Boost recently rescued pets for visibility</span>', cls: '' },
            { text: '    <span class="syn-keyword">const</span> recencyBoost = pet.daysSinceRescue &lt; <span class="syn-number">14</span>', cls: '' },
            { text: '      ? <span class="syn-number">0.08</span>', cls: '' },
            { text: '      : <span class="syn-number">0</span>;', cls: '' },
            { text: '' },
            { text: '    <span class="syn-keyword">return</span> {', cls: '' },
            { text: '      pet,', cls: '' },
            { text: '      score: Math.<span class="syn-function">min</span>(<span class="syn-number">1</span>, raw + recencyBoost),', cls: '' },
            { text: '      breakdown: <span class="syn-function">computeBreakdown</span>(userVector, petVector),', cls: '' },
            { text: '    };', cls: '' },
            { text: '  });', cls: '' },
            { text: '' },
            { text: '  <span class="syn-keyword">return</span> scored', cls: '' },
            { text: '    .<span class="syn-function">sort</span>((a, b) <span class="syn-keyword">=></span> b.score - a.score)', cls: '' },
            { text: '    .<span class="syn-function">slice</span>(<span class="syn-number">0</span>, limit);', cls: '' },
            { text: '}', cls: '' },
          ],
          commit: 'Implement weighted pet matching algorithm'
        },
        {
          filename: 'api/match.ts',
          branch: 'feat/matching-algo',
          lines: [
            { text: '// POST /api/match — returns ranked pet matches', cls: 'syn-comment' },
            { text: '' },
            { text: '<span class="syn-keyword">import</span> { <span class="syn-function">createHandler</span> } <span class="syn-keyword">from</span> <span class="syn-string">\'@forge/api\'</span>;', cls: '' },
            { text: '<span class="syn-keyword">import</span> { <span class="syn-function">findMatches</span> } <span class="syn-keyword">from</span> <span class="syn-string">\'../matcher\'</span>;', cls: '' },
            { text: '<span class="syn-keyword">import</span> { <span class="syn-function">validatePrefs</span> } <span class="syn-keyword">from</span> <span class="syn-string">\'../validation\'</span>;', cls: '' },
            { text: '<span class="syn-keyword">import</span> { db } <span class="syn-keyword">from</span> <span class="syn-string">\'../db\'</span>;', cls: '' },
            { text: '' },
            { text: '<span class="syn-keyword">export const</span> <span class="syn-function">matchHandler</span> = <span class="syn-function">createHandler</span>({', cls: '' },
            { text: '  method: <span class="syn-string">\'POST\'</span>,', cls: '' },
            { text: '  path: <span class="syn-string">\'/api/match\'</span>,', cls: '' },
            { text: '' },
            { text: '  <span class="syn-keyword">async</span> <span class="syn-function">handler</span>(req, res) {', cls: '' },
            { text: '    <span class="syn-keyword">const</span> prefs = <span class="syn-function">validatePrefs</span>(req.body);', cls: '' },
            { text: '' },
            { text: '    <span class="syn-keyword">const</span> pets = <span class="syn-keyword">await</span> db.pets', cls: '' },
            { text: '      .<span class="syn-function">findAvailable</span>({', cls: '' },
            { text: '        region: prefs.region,', cls: '' },
            { text: '        species: prefs.species,', cls: '' },
            { text: '      });', cls: '' },
            { text: '' },
            { text: '    <span class="syn-keyword">const</span> matches = <span class="syn-keyword">await</span> <span class="syn-function">findMatches</span>(prefs, pets);', cls: '' },
            { text: '' },
            { text: '    <span class="syn-comment">// Track impressions for analytics</span>', cls: '' },
            { text: '    <span class="syn-keyword">await</span> db.analytics.<span class="syn-function">trackImpressions</span>({', cls: '' },
            { text: '      userId: req.auth.userId,', cls: '' },
            { text: '      petIds: matches.<span class="syn-function">map</span>(m <span class="syn-keyword">=></span> m.pet.id),', cls: '' },
            { text: '      timestamp: Date.<span class="syn-function">now</span>(),', cls: '' },
            { text: '    });', cls: '' },
            { text: '' },
            { text: '    res.<span class="syn-function">json</span>({', cls: '' },
            { text: '      matches,', cls: '' },
            { text: '      total: pets.length,', cls: '' },
            { text: '      cached: <span class="syn-keyword">false</span>,', cls: '' },
            { text: '    });', cls: '' },
            { text: '  },', cls: '' },
            { text: '});', cls: '' },
          ],
          commit: 'Add match API endpoint with analytics tracking'
        },
        {
          filename: 'scoring.ts',
          branch: 'feat/scoring-v2',
          lines: [
            { text: '// Karma-weighted scoring for contributor reputation', cls: 'syn-comment' },
            { text: '' },
            { text: '<span class="syn-keyword">import</span> { Contributor, KarmaTier } <span class="syn-keyword">from</span> <span class="syn-string">\'./types\'</span>;', cls: '' },
            { text: '' },
            { text: '<span class="syn-keyword">const</span> <span class="syn-function">TIER_MULTIPLIERS</span>: <span class="syn-type">Record</span>&lt;<span class="syn-type">KarmaTier</span>, <span class="syn-type">number</span>&gt; = {', cls: '' },
            { text: '  observer: <span class="syn-number">1.0</span>,', cls: '' },
            { text: '  contributor: <span class="syn-number">1.2</span>,', cls: '' },
            { text: '  builder: <span class="syn-number">1.5</span>,', cls: '' },
            { text: '  architect: <span class="syn-number">2.0</span>,', cls: '' },
            { text: '  partner: <span class="syn-number">2.5</span>,', cls: '' },
            { text: '  foundersCircle: <span class="syn-number">3.0</span>,', cls: '' },
            { text: '};', cls: '' },
            { text: '' },
            { text: '<span class="syn-keyword">export function</span> <span class="syn-function">calculateKarma</span>(', cls: '' },
            { text: '  contributor: <span class="syn-type">Contributor</span>', cls: '' },
            { text: '): <span class="syn-type">number</span> {', cls: '' },
            { text: '  <span class="syn-keyword">const</span> base =', cls: '' },
            { text: '    contributor.mergedPRs * <span class="syn-number">10</span> +', cls: '' },
            { text: '    contributor.reviewsGiven * <span class="syn-number">5</span> +', cls: '' },
            { text: '    contributor.issuesClosed * <span class="syn-number">3</span> +', cls: '' },
            { text: '    contributor.mentorSessions * <span class="syn-number">15</span>;', cls: '' },
            { text: '' },
            { text: '  <span class="syn-keyword">const</span> multiplier = <span class="syn-function">TIER_MULTIPLIERS</span>[contributor.tier];', cls: '' },
            { text: '  <span class="syn-keyword">const</span> streakBonus = contributor.dayStreak > <span class="syn-number">7</span>', cls: '' },
            { text: '    ? Math.<span class="syn-function">log2</span>(contributor.dayStreak) * <span class="syn-number">2</span>', cls: '' },
            { text: '    : <span class="syn-number">0</span>;', cls: '' },
            { text: '' },
            { text: '  <span class="syn-keyword">return</span> Math.<span class="syn-function">round</span>(base * multiplier + streakBonus);', cls: '' },
            { text: '}', cls: '' },
          ],
          commit: 'Add karma tier scoring with streak bonuses'
        }
      ];

      let currentBlockIdx = 0;
      let currentLineIdx = 0;
      let currentCharIdx = 0;
      let typedLines = [];
      let isTyping = true;

      const codeLinesEl = document.getElementById('code-lines');
      const codeScrollEl = document.getElementById('code-scroll');
      const codeStageEl = document.getElementById('code-stage');
      const commitOverlayEl = document.getElementById('commit-overlay');
      const commitMsgEl = document.getElementById('commit-msg');

      function stripHtml(html) {
        const tmp = document.createElement('div');
        tmp.innerHTML = html;
        return tmp.textContent || '';
      }

      function renderCodeLines() {
        let html = '';
        for (let i = 0; i < typedLines.length; i++) {
          const isActive = i === typedLines.length - 1 && isTyping;
          html += `<div class="code-line-number">${i + 1}</div>`;
          html += `<div class="code-line-content${isActive ? ' code-line-active' : ''}">${typedLines[i]}${isActive ? '<span class="code-cursor" aria-hidden="true"></span>' : ''}</div>`;
        }
        codeLinesEl.innerHTML = html;
        codeScrollEl.scrollTop = codeScrollEl.scrollHeight;
      }

      function typeNextChar() {
        const block = codeBlocks[currentBlockIdx];
        const line = block.lines[currentLineIdx];
        const plainText = stripHtml(line.text);

        if (currentCharIdx === 0 && currentLineIdx === typedLines.length) {
          typedLines.push('');
        }

        if (currentCharIdx < plainText.length) {
          typedLines[typedLines.length - 1] = line.text.substring(0, getHtmlIndexForPlainIndex(line.text, currentCharIdx + 1));
          currentCharIdx++;
          renderCodeLines();

          const baseDelay = plainText[currentCharIdx - 1] === ' ' ? 20 : 45;
          const variance = Math.random() * 40 - 10;
          const delay = Math.max(15, baseDelay + variance);
          setTimeout(typeNextChar, delay);
        } else {
          currentCharIdx = 0;
          currentLineIdx++;

          if (currentLineIdx < block.lines.length) {
            typedLines.push('');
            renderCodeLines();
            const lineBreakDelay = plainText === '' ? 150 : 250 + Math.random() * 200;
            setTimeout(typeNextChar, lineBreakDelay);
          } else {
            isTyping = false;
            renderCodeLines();
            setTimeout(function () { triggerCommit(block.commit); }, 1500);
          }
        }
      }

      function getHtmlIndexForPlainIndex(html, plainIdx) {
        let plain = 0;
        let inTag = false;
        for (let i = 0; i < html.length; i++) {
          if (html[i] === '<') { inTag = true; continue; }
          if (html[i] === '>') { inTag = false; continue; }
          if (!inTag) {
            plain++;
            if (plain === plainIdx) {
              let end = i + 1;
              while (end < html.length && html[end] === '<') {
                const closeIdx = html.indexOf('>', end);
                if (closeIdx === -1) break;
                end = closeIdx + 1;
              }
              return end;
            }
          }
        }
        return html.length;
      }

      function triggerCommit(message) {
        codeStageEl.classList.add('commit-flash');
        commitMsgEl.textContent = message;
        commitOverlayEl.classList.add('visible');

        setTimeout(function () {
          commitOverlayEl.classList.remove('visible');
          codeStageEl.classList.remove('commit-flash');

          setTimeout(function () {
            currentBlockIdx = (currentBlockIdx + 1) % codeBlocks.length;
            currentLineIdx = 0;
            currentCharIdx = 0;
            typedLines = [];
            isTyping = true;

            const block = codeBlocks[currentBlockIdx];
            const tabEl = document.querySelector('.code-chrome-tab');
            const branchEl = document.querySelector('.code-chrome-branch');
            tabEl.innerHTML = `<svg class="code-chrome-tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="m18 16 4-4-4-4"/><path d="m6 8-4 4 4 4"/><path d="m14.5 4-5 16"/></svg>${block.filename}`;
            branchEl.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><line x1="6" y1="3" x2="6" y2="15"/><circle cx="18" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><path d="M18 9a9 9 0 0 1-9 9"/></svg>${block.branch}`;

            codeLinesEl.innerHTML = '';
            typeNextChar();
          }, 2000);
        }, 2500);
      }

      // Start typing
      typeNextChar();


      // ── ACTIVITY LOG ──
      const activityEvents = [
        { dot: 'cyan', text: '<strong>@carol</strong> merged PR #18', time: '2m ago' },
        { dot: 'violet', text: '<span class="bot-name">Bot-7</span> submitted fix for #22', time: '3m ago' },
        { dot: 'green', text: '<strong>@dave</strong> claimed task: Auth Flow', time: '4m ago' },
        { dot: 'amber', text: 'Staging deployed <strong>v0.4.3</strong>', time: '5m ago' },
        { dot: 'gold', text: '<strong>@eve</strong> closed <strong>$1.2K</strong> deal', time: '7m ago' },
        { dot: 'cyan', text: '<strong>@alice</strong> opened PR #19: refactor matching', time: '8m ago' },
        { dot: 'coral', text: 'CI failed on <strong>feat/auth</strong> — 2 tests', time: '9m ago' },
        { dot: 'green', text: '<strong>@frank</strong> resolved merge conflict', time: '10m ago' },
        { dot: 'violet', text: '<span class="bot-name">Bot-3</span> auto-formatted 14 files', time: '11m ago' },
        { dot: 'cyan', text: '<strong>@grace</strong> reviewed PR #17', time: '12m ago' },
        { dot: 'amber', text: 'Production deployed <strong>v0.4.2</strong>', time: '14m ago' },
        { dot: 'green', text: '<strong>@dave</strong> completed task: DB Migration', time: '15m ago' },
        { dot: 'gold', text: '<strong>@eve</strong> added 3 enterprise leads', time: '17m ago' },
        { dot: 'violet', text: '<span class="bot-name">Bot-7</span> flagged perf regression in matcher', time: '18m ago' },
        { dot: 'cyan', text: '<strong>@carol</strong> pushed 4 commits to main', time: '20m ago' },
      ];

      const newActivityEvents = [
        { dot: 'green', text: '<strong>@hank</strong> claimed task: Rate Limiter', time: 'just now' },
        { dot: 'cyan', text: '<strong>@carol</strong> approved PR #19', time: 'just now' },
        { dot: 'violet', text: '<span class="bot-name">Bot-3</span> detected unused import in scorer.ts', time: 'just now' },
        { dot: 'amber', text: 'Staging deployed <strong>v0.4.4</strong>', time: 'just now' },
        { dot: 'gold', text: '<strong>@eve</strong> closed <strong>$800</strong> deal', time: 'just now' },
        { dot: 'coral', text: 'CI passed on <strong>feat/matching-algo</strong>', time: 'just now' },
        { dot: 'green', text: '<strong>@frank</strong> completed code review for #20', time: 'just now' },
        { dot: 'cyan', text: '<strong>@alice</strong> merged PR #20', time: 'just now' },
        { dot: 'violet', text: '<span class="bot-name">Bot-7</span> opened PR #21: fix null ref', time: 'just now' },
        { dot: 'amber', text: 'Health check: all systems <strong>nominal</strong>', time: 'just now' },
        { dot: 'green', text: '<strong>@dave</strong> pushed hotfix for auth timeout', time: 'just now' },
        { dot: 'gold', text: '<strong>@eve</strong> onboarded new partner org', time: 'just now' },
      ];

      const activityFeed = document.getElementById('activity-feed');
      let displayedEvents = [];
      let newEventIdx = 0;

      function createEventEl(event) {
        const el = document.createElement('div');
        el.className = 'activity-event';
        el.innerHTML = `
          <div class="activity-dot activity-dot--${event.dot}" aria-hidden="true"></div>
          <div class="activity-content">
            <div class="activity-text">${event.text}</div>
            <div class="activity-time">${event.time}</div>
          </div>
        `;
        return el;
      }

      // Seed initial events
      activityEvents.forEach(function (event) {
        const el = createEventEl(event);
        activityFeed.appendChild(el);
        displayedEvents.push(el);
      });

      // Add new events periodically
      setInterval(function () {
        const event = newActivityEvents[newEventIdx % newActivityEvents.length];
        newEventIdx++;

        const el = createEventEl(event);
        activityFeed.insertBefore(el, activityFeed.firstChild);
        displayedEvents.unshift(el);

        // Fade out old events
        if (displayedEvents.length > 12) {
          const old = displayedEvents[displayedEvents.length - 1];
          old.classList.add('fading');
          setTimeout(function () {
            if (old.parentNode) old.parentNode.removeChild(old);
            displayedEvents.pop();
          }, 500);
        }

        // Update count
        const countEl = document.getElementById('activity-count');
        const current = parseInt(countEl.textContent);
        countEl.textContent = (current + 1) + ' today';
      }, 3500);


      // ── CHAT MESSAGES ──
      const initialChatMessages = [
        { name: 'carol', avatar: 'C', color: 'cyan', text: 'just pushed the matching algo, needs review', time: '2:14 PM', bot: false },
        { name: 'dave', avatar: 'D', color: 'green', text: 'on it, pulling now', time: '2:14 PM', bot: false },
        { name: 'Bot-7', avatar: 'B7', color: 'violet', text: 'I found a potential null reference in line 42 of matcher.ts', time: '2:15 PM', bot: true },
        { name: 'eve', avatar: 'E', color: 'amber', text: 'first enterprise lead came in! they want a demo next week', time: '2:16 PM', bot: false },
        { name: 'alice', avatar: 'A', color: 'coral', text: 'amazing work team, let\'s ship this today', time: '2:17 PM', bot: false },
        { name: 'carol', avatar: 'C', color: 'cyan', text: 'good catch Bot-7, fixing that now', time: '2:17 PM', bot: false },
        { name: 'frank', avatar: 'F', color: 'green', text: 'the scoring weights look solid. +1 on the PR', time: '2:18 PM', bot: false },
      ];

      const newChatMessages = [
        { name: 'dave', avatar: 'D', color: 'green', text: 'review done, left two comments on the vector normalization', time: '', bot: false },
        { name: 'carol', avatar: 'C', color: 'cyan', text: 'addressed both, updated the PR', time: '', bot: false },
        { name: 'Bot-3', avatar: 'B3', color: 'violet', text: 'lint check passed. no issues found.', time: '', bot: true },
        { name: 'eve', avatar: 'E', color: 'amber', text: 'scheduled the demo for Thursday. need the matching flow polished by then', time: '', bot: false },
        { name: 'alice', avatar: 'A', color: 'coral', text: 'Thursday works. carol, can you own the demo prep?', time: '', bot: false },
        { name: 'carol', avatar: 'C', color: 'cyan', text: 'yes, i\'ll get the happy path working smoothly', time: '', bot: false },
        { name: 'frank', avatar: 'F', color: 'green', text: 'deploying v0.4.4 to staging now', time: '', bot: false },
        { name: 'Bot-7', avatar: 'B7', color: 'violet', text: 'staging healthcheck: all 12 endpoints responding. avg latency 42ms.', time: '', bot: true },
        { name: 'dave', avatar: 'D', color: 'green', text: 'looks clean. merging to main.', time: '', bot: false },
        { name: 'alice', avatar: 'A', color: 'coral', text: 'let\'s go! shipping day energy', time: '', bot: false },
        { name: 'eve', avatar: 'E', color: 'amber', text: 'second lead just reached out through the landing page', time: '', bot: false },
        { name: 'carol', avatar: 'C', color: 'cyan', text: 'the recency boost is working really well in testing', time: '', bot: false },
      ];

      const chatMessagesEl = document.getElementById('chat-messages');
      let newChatIdx = 0;

      function getTimeStr() {
        const d = new Date();
        let h = d.getHours();
        const m = d.getMinutes().toString().padStart(2, '0');
        const ampm = h >= 12 ? 'PM' : 'AM';
        h = h % 12 || 12;
        return h + ':' + m + ' ' + ampm;
      }

      function createChatEl(msg) {
        const el = document.createElement('div');
        el.className = 'chat-msg';
        const timeStr = msg.time || getTimeStr();
        el.innerHTML = `
          <div class="chat-avatar chat-avatar--${msg.color}">${msg.avatar}</div>
          <div class="chat-body">
            <div class="chat-meta">
              <span class="chat-name${msg.bot ? ' chat-name--bot' : ''}">${msg.name}</span>
              <span class="chat-time">${timeStr}</span>
            </div>
            <div class="chat-text">${msg.text}</div>
          </div>
        `;
        return el;
      }

      // Seed initial messages
      initialChatMessages.forEach(function (msg) {
        chatMessagesEl.appendChild(createChatEl(msg));
      });
      chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;

      // Add new messages periodically
      setInterval(function () {
        const msg = newChatMessages[newChatIdx % newChatMessages.length];
        newChatIdx++;

        chatMessagesEl.appendChild(createChatEl(msg));
        chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;

        // Keep message count reasonable
        while (chatMessagesEl.children.length > 20) {
          chatMessagesEl.removeChild(chatMessagesEl.firstChild);
        }
      }, 4500);


      // ── SPECTATOR COUNT ──
      const spectatorEl = document.getElementById('spectator-count');
      let spectatorCount = 1247;

      setInterval(function () {
        const delta = Math.random() > 0.4 ? 1 : (Math.random() > 0.7 ? -1 : 2);
        spectatorCount = Math.max(1200, spectatorCount + delta);
        spectatorEl.textContent = spectatorCount.toLocaleString();
      }, 5000);


      // ── BOTTOM BAR METRICS ──
      let lastCommitSeconds = 12;
      const lastCommitEl = document.getElementById('last-commit-time');

      setInterval(function () {
        lastCommitSeconds++;
        if (lastCommitSeconds > 90) lastCommitSeconds = 3;
        if (lastCommitSeconds < 60) {
          lastCommitEl.textContent = lastCommitSeconds + 's';
        } else {
          lastCommitEl.textContent = Math.floor(lastCommitSeconds / 60) + 'm ' + (lastCommitSeconds % 60) + 's';
        }
      }, 1000);

      // Reset commit timer on commit flash
      const origTriggerCommit = triggerCommit;

      const commitObserver = new MutationObserver(function (mutations) {
        mutations.forEach(function (m) {
          if (m.target.classList.contains('commit-flash')) {
            lastCommitSeconds = 0;
          }
        });
      });
      commitObserver.observe(codeStageEl, { attributes: true, attributeFilter: ['class'] });

      // Tasks metric subtle changes
      const tasksMetricEl = document.getElementById('tasks-metric');
      const tasksProgressEl = document.getElementById('tasks-progress');
      let tasksOpen = 8;
      let tasksInProgress = 4;
      let tasksDone = 34;

      setInterval(function () {
        const r = Math.random();
        if (r < 0.3 && tasksInProgress > 0) {
          tasksInProgress--;
          tasksDone++;
        } else if (r < 0.5 && tasksOpen > 0) {
          tasksOpen--;
          tasksInProgress++;
        } else if (r < 0.6) {
          tasksOpen++;
        }
        tasksOpen = Math.max(2, tasksOpen);
        tasksInProgress = Math.max(1, tasksInProgress);
        const total = tasksOpen + tasksInProgress + tasksDone;
        const pct = Math.round((tasksDone / total) * 100);
        tasksMetricEl.innerHTML = '<strong>' + tasksOpen + '</strong> open / <strong>' + tasksInProgress + '</strong> in progress / <strong>' + tasksDone + '</strong> done';
        tasksProgressEl.style.width = pct + '%';
      }, 8000);

      // Revenue subtle changes
      const revenueEl = document.getElementById('revenue-metric');
      let revenue = 2840;

      setInterval(function () {
        if (Math.random() < 0.3) {
          revenue += Math.floor(Math.random() * 40) + 10;
          revenueEl.textContent = '$' + revenue.toLocaleString() + '/mo';
        }
      }, 12000);

      // Contributors count
      const contributorsEl = document.getElementById('contributors-count');
      let contributorsCount = 12;

      setInterval(function () {
        const d = Math.random() > 0.5 ? 1 : -1;
        contributorsCount = Math.max(8, Math.min(18, contributorsCount + d));
        contributorsEl.textContent = contributorsCount;
      }, 10000);


      // ── KEYBOARD SHORTCUTS ──
      document.addEventListener('keydown', function (e) {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

        if (e.key === 'f' || e.key === 'F') {
          e.preventDefault();
          toggleFullscreen();
        }

        if (e.key === 'Escape') {
          if (document.fullscreenElement) {
            document.exitFullscreen();
          }
        }
      });

      function toggleFullscreen() {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen().catch(function () {
            // Fullscreen not available
          });
        } else {
          document.exitFullscreen();
        }
      }

      document.getElementById('fullscreen-btn').addEventListener('click', toggleFullscreen);

    })();
  </script>
</body>
</html>
